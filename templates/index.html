<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Healthcare Risk Assessment</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { background: #f4f6f9; }
        .badge-low { background-color: #198754; }
        .badge-medium { background-color: #ffc107; color: #000; }
        .badge-high { background-color: #dc3545; }
    </style>
</head>
<body>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">

            <div class="card shadow-lg">
                <div class="card-header bg-primary text-white text-center">
                    <h4>Healthcare Risk Assessment</h4>
                    <small>AI-powered preventive screening tool</small>
                </div>

                <div class="card-body">
                    <form method="post">

                        <div class="row mb-3">
                            <div class="col">
                                <label>Age</label>
                                <input type="number" name="age" class="form-control" value="{{ defaults.age }}" required>
                            </div>
                            <div class="col">
                                <label>BMI</label>
                                <input type="number" step="0.1" name="bmi" class="form-control" value="{{ defaults.bmi }}" required>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col">
                                <label>Cholesterol</label>
                                <input type="number" name="cholesterol" class="form-control" value="{{ defaults.cholesterol }}" required>
                            </div>
                            <div class="col">
                                <label>Glucose</label>
                                <input type="number" name="glucose" class="form-control" value="{{ defaults.glucose }}" required>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col">
                                <label>Smoking</label>
                                <select name="smoking" class="form-select">
                                    <option value="0">No</option>
                                    <option value="1">Yes</option>
                                </select>
                            </div>
                            <div class="col">
                                <label>Family History</label>
                                <select name="family_history" class="form-select">
                                    <option value="0">No</option>
                                    <option value="1">Yes</option>
                                </select>
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col">
                                <label>Sleep Hours</label>
                                <input type="number" step="0.1" name="sleep_hours" class="form-control" value="{{ defaults.sleep_hours }}" required>
                            </div>
                            <div class="col">
                                <label>Diet Quality (1–10)</label>
                                <input type="number" min="1" max="10" name="diet_quality" class="form-control" value="{{ defaults.diet_quality }}" required>
                            </div>
                        </div>

                        <div class="d-grid">
                            <button class="btn btn-primary btn-lg">Assess Risk</button>
                        </div>
                    </form>

                    {% if probability is not none %}
                    <hr>

                    <div class="text-center">
                        <h5>
                            Risk Category:
                            <span class="badge badge-{{ risk_label|lower }}">
                                {{ risk_label }}
                            </span>
                        </h5>

                        <p class="mt-2">
                            Risk Probability: <strong>{{ probability }}</strong>
                        </p>

                        {% if top_drivers %}
                        <div class="text-start mt-3">
                            <h6>Key Risk Drivers</h6>
                            <ul>
                                {% for d in top_drivers %}
                                <li>{{ d }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}

                        {% if recommendations and risk_label != "Low" %}
                        <div class="text-start mt-3">
                            <h6>Personalized Recommendations</h6>
                            <ul>
                                {% for r in recommendations %}
                                <li>{{ r }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}

                        <canvas id="riskChart" class="mt-3"></canvas>

                        <p class="text-muted mt-3" style="font-size: 0.85rem;">
                            ⚠️ This is a screening-level risk assessment, not a medical diagnosis.
                        </p>
                    </div>
                    {% endif %}
                </div>

                <div class="card-footer text-center text-muted">
                    Educational & Preventive Use Only
                </div>
            </div>

        </div>
    </div>
</div>

{% if probability is not none %}
<script>
const ctx = document.getElementById('riskChart');
new Chart(ctx, {
    type: 'doughnut',
    data: {
        labels: ['Risk', 'Remaining'],
        datasets: [{
            data: [{{ probability*100 }}, {{ 100 - probability*100 }}],
            backgroundColor: ['#dc3545', '#e9ecef'],
            borderWidth: 0
        }]
    },
    options: {
        cutout: '70%',
        plugins: { legend: { display: false } }
    }
});
</script>
{% endif %}

</body>
</html>
